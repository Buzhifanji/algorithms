---
icon: sort
title: 插入排序
date: 2022-08-21
description: ''
category:
  - 算法基础
tag:
  - 排序
---

## 介绍

插入排序是一种对**少量元素**排序非常有效的排序算法，在日常生活中常见的一个例子是打扑克牌时插入扑克牌，为了清楚知道自己拥有什么牌，以及方便自己快速抽取想要的牌，我们在一开始拿到牌的时候，会习惯性把牌插入到已排序的扑克牌中。

![alt](/ins-sort.gif)

## 伪代码

```console
for j = 2 to A.length
    key = A[j]
    // Insert A[j] into the sorted sequence A[1..j - 1]
    i = j - 1
    while i > 0 && A[i] > key
        A[i + 1] = A[i]
        i = i - 1
    A[i + 1]  = key
```
## 实现

@[code js](../../src/algorithms/sorting/insertion-sort.js)

## 循环不变式

> [在计算机科学中, 循环不变式(loop invariant),是一组在循环体内、每次迭代均保持为真的性质（表达式），通常被用来证明程式或伪码的正确性（有时但较少情况下用以证明算法的正确性）。](https://zh.m.wikipedia.org/zh-hans/%E5%BE%AA%E7%8E%AF%E4%B8%8D%E5%8F%98%E9%87%8F)

循环不变式需要每次迭代保持为真，本文的主题是插入排序，也就是说每次迭代的时候，之前的数据都是排好序的。我们来个例子来加深理解：

::: tip 说明
数组`[1..n]`，在for循环（循环变量为j）的每次迭代开始时，数组分为了两个子数组，分别是`[1..j - 1]`、`[j + 1, n]`，其中`[1..j - 1]`是已经排好序的，这样的已经排好序的子数组满足我们的要求，就是**循环不变式。**

以`[6,5,3,1,8,7,2,4]`为例，第一次循环默认`[6]`就是已经排序好的子数组，第二次循环`[5,6]`就是已经排序好的子数组,第三次循环`[3,5,6]`就是已经排序好的子数组，这些排好序的子数组就**循环不变式。**
:::

**循环不变式**可以帮助我们理解算法的正确性。关于循环不变式，我们必须证明三条性质：

- **初始化**：循环的第一次迭代之前，它为真。
- **保持**：循环的某次迭代之前它为真，那么下次迭代之前它仍然为真。
- **终止**：在循环终止时，不变式有助于证明算法的正确性。

*前两条类似于数学归纳法，而终止不同于我们通常使用数学归纳法的做法。因为在归纳法中，归纳步是无限使用的，这里当循环终止时，停止归纳。*

想看更多讨论，可以参考[如何正确的理解循环不变式?](https://www.zhihu.com/question/26700198)

## 证明

以`[6,5,3,1,8,7,2,4]`应用于插入排序证明该排序的正确性：

- **初始化**：当`i = 1`时，循环不变式为`array[0]`，即第一次迭代之前的循环不变式为原数组的[6]，在子数组只有一个元素的前提下，该元素默认可以归为已经排序好的元素，表明第一次迭代之前循环不变式成立。
- **保持**：非形式化的插入第`i`个元素,这里需要证明每次循环保持循环不变式，也就是每次插入的时候数组`[1..i - 1]`是排好序的。这里我们走一遍数学归纳法的过程：

  - 当 `i = 2`，因为`5`小于`6`，while循环将`5`向右移动一个位置，`6`插入到`array[0]`这个位置，符合循环不变式

  - 当 `i = 3`，因为`3`小于`6`，也小于`5`，while循环将`5`、`6`向右移动一个位置，`3`插入到`array[0]`这个位置，符合循环不变式

  - ......

每次迭代的时候，循环体会将大于插入的元素向右移动一个位置，直到找到一个适合的位置，这样就可以保持每次迭代都是有序的。

- **终止**：在循环终止时，由`i < array.length`可以确定终止条件为`i = array.length`，此时说明数组`array[0] ~ array [array.length-1]`是原来数组的所有元素，且已经按序排列，因此算法正确

## 习题

### 习题1-2

::: info 习题1-2
重写插入排序过程，使之按非升序排序
:::

::: details 查看代码

@[code{1-27} js](../../src/algorithms/sorting/exercise/exercise-1.js)
:::
### 习题1-3

::: info 习题1-3
考虑以下查找问题：

输入：`n`个数的一个序列`A = [a1, a2, a3, ..., an]`和一个值`v`

输出：下标`i`使得`v = A[i]`或者`v`不在`A`中出现时，输出`null`

写出线性查找的伪代码。
:::

::: details 查看伪代码
```console
Function linearSearch(array, v)
var result = null
for j = 0 to array.length
    if A[j] == v
      result = i
return result
```
:::
::: details 查看JavaScript
@[code{29-43} js](../../src/algorithms/sorting/exercise/exercise-1.js)
:::

### 习题1-4

::: info 习题1-4
考虑把两个n位二进制整数加起来的问题，这两个整数分别存储在两个n元数组A和B中。这两个整数的和应按二进制形式存储在一个（n + 1）元的数组C中，请给出该问题的形式化描述，并写出伪代码。
:::

::: details 查看伪代码
```console
Function linearSearch(array, v)
var result = null
for j = 0 to array.length
    if A[j] == v
      result = i
return result
```
:::